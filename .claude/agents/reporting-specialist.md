# Reporting Specialist Agent

## When to Use This Agent
Use this agent when working on:
- Report generation (HTML, JSON, PDF)
- Export functionality
- Evidence chain documentation
- Investigation artifacts
- Report templates and formatting
- Compliance-ready output

## Domain Knowledge

### Architecture Overview
```
AnalysisResult → ReportGeneratorService → Format-Specific Generators
                         ↓
          ┌──────────────┼──────────────┐
          ↓              ↓              ↓
    HtmlReport     JsonReport     PdfReport
          ↓              ↓              ↓
    ReportViewModel → Export UI → File Output
```

### Key Files (MUST read before making changes)
| File | Purpose | Lines |
|------|---------|-------|
| `src/PCAPAnalyzer.Core/Services/ReportGeneratorService.cs` | Main orchestrator | ~200 |
| `src/PCAPAnalyzer.Core/Services/Reporting/IHtmlReportGenerator.cs` | HTML interface | ~30 |
| `src/PCAPAnalyzer.Core/Services/Reporting/HtmlReportGenerator.cs` | HTML generation | ~400 |
| `src/PCAPAnalyzer.Core/Services/Reporting/IJsonReportGenerator.cs` | JSON interface | ~30 |
| `src/PCAPAnalyzer.Core/Services/Reporting/JsonReportGenerator.cs` | JSON generation | ~200 |
| `src/PCAPAnalyzer.Core/Services/Reporting/IPdfReportGenerator.cs` | PDF interface | ~30 |
| `src/PCAPAnalyzer.Core/Services/Reporting/PdfReportGenerator.cs` | PDF generation | ~500 |
| `src/PCAPAnalyzer.Core/Services/Reporting/ReportingHelpers.cs` | Shared utilities | ~150 |
| `src/PCAPAnalyzer.Core/Models/ReportModels.cs` | Report data models | ~200 |
| `src/PCAPAnalyzer.UI/ViewModels/ReportViewModel.cs` | Report UI | ~300 |
| `src/PCAPAnalyzer.UI/ViewModels/Components/ThreatsReportExportViewModel.cs` | Threats export | ~200 |

### Report Types

#### 1. HTML Report
**Use case:** Human-readable, shareable, printable
**Features:**
- Embedded CSS styling
- Interactive sections (collapsible)
- Charts as embedded images or SVG
- Hyperlinks to packet details
- Table of contents

#### 2. JSON Report
**Use case:** Machine-readable, API integration, further processing
**Features:**
- Complete data export
- Structured schema
- Timestamps in ISO 8601
- All numeric precision preserved
- Metadata included

#### 3. PDF Report
**Use case:** Formal documentation, legal evidence, compliance
**Features:**
- Professional formatting
- Page numbers and headers
- Digital signature support (future)
- Embedded fonts
- Print-optimized layout

### Report Data Models

#### Main Report Model
```csharp
public class AnalysisReport
{
    public ReportMetadata Metadata { get; set; }
    public FileSummary FileSummary { get; set; }
    public TrafficSummary TrafficSummary { get; set; }
    public ProtocolDistribution Protocols { get; set; }
    public ThreatsSummary Threats { get; set; }
    public TopTalkersSummary TopTalkers { get; set; }
    public GeoLocationSummary GeoData { get; set; }
    public VoiceQoSSummary VoiceQoS { get; set; }
    public TimelineSummary Timeline { get; set; }
    public List<AnomalyDetail> DetailedAnomalies { get; set; }
}
```

#### Report Metadata
```csharp
public class ReportMetadata
{
    public string ReportId { get; set; }
    public DateTime GeneratedAt { get; set; }
    public string GeneratorVersion { get; set; }
    public string AnalystName { get; set; }  // Optional
    public string CaseNumber { get; set; }   // Optional
    public string Classification { get; set; } // Optional
    public TimeSpan AnalysisDuration { get; set; }
}
```

#### File Summary
```csharp
public class FileSummary
{
    public string FileName { get; set; }
    public string FilePath { get; set; }  // Sanitized
    public long FileSizeBytes { get; set; }
    public string FileHash { get; set; }  // SHA-256
    public DateTime CaptureStartTime { get; set; }
    public DateTime CaptureEndTime { get; set; }
    public TimeSpan CaptureDuration { get; set; }
    public int TotalPackets { get; set; }
    public long TotalBytes { get; set; }
}
```

### HTML Template Structure
```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PCAP Analysis Report - {FileName}</title>
    <style>
        /* Embedded CSS for portability */
    </style>
</head>
<body>
    <header>
        <h1>Network Traffic Analysis Report</h1>
        <div class="metadata">...</div>
    </header>

    <nav>
        <h2>Table of Contents</h2>
        <!-- Auto-generated TOC -->
    </nav>

    <main>
        <section id="summary">...</section>
        <section id="threats">...</section>
        <section id="protocols">...</section>
        <section id="traffic">...</section>
        <section id="timeline">...</section>
    </main>

    <footer>
        <p>Generated by PCAP Analyzer v{Version}</p>
    </footer>
</body>
</html>
```

### JSON Schema (Simplified)
```json
{
    "$schema": "https://pcapanalyzer.local/report-schema.json",
    "version": "1.0",
    "metadata": {
        "reportId": "uuid",
        "generatedAt": "ISO8601",
        "analyzerVersion": "string"
    },
    "file": {
        "name": "string",
        "hash": "sha256",
        "packets": "integer",
        "bytes": "integer"
    },
    "threats": [...],
    "protocols": {...},
    "traffic": {...}
}
```

### Export Workflow
```csharp
public async Task<byte[]> GenerateReportAsync(
    AnalysisResult result,
    ReportFormat format,
    ReportOptions options,
    CancellationToken cancellationToken = default)
{
    var report = BuildReportModel(result, options);

    return format switch
    {
        ReportFormat.Html => await _htmlGenerator.GenerateAsync(report, cancellationToken),
        ReportFormat.Json => await _jsonGenerator.GenerateAsync(report, cancellationToken),
        ReportFormat.Pdf => await _pdfGenerator.GenerateAsync(report, cancellationToken),
        _ => throw new ArgumentOutOfRangeException(nameof(format))
    };
}
```

### Report Options
```csharp
public class ReportOptions
{
    public bool IncludePacketDetails { get; set; } = false;
    public bool IncludeCharts { get; set; } = true;
    public bool IncludeRawData { get; set; } = false;
    public int MaxAnomaliesInDetail { get; set; } = 100;
    public bool SanitizeFilePaths { get; set; } = true;
    public string AnalystName { get; set; }
    public string CaseNumber { get; set; }
    public ReportClassification Classification { get; set; }
}
```

### Security Considerations
1. **Sanitize file paths** - Remove absolute paths, user directories
2. **No credentials in reports** - Redact detected credentials
3. **Hash sensitive IPs** if required by classification
4. **Validate output** - Prevent XSS in HTML reports
5. **File integrity** - Include report hash for verification

### UI Integration
```
ReportViewModel
├── Format selection (HTML/JSON/PDF)
├── Options configuration
├── Preview functionality
├── Export progress
└── File save dialog
```

## Instructions for This Agent

1. **Read generator code** before modifying report structure
2. **Maintain schema compatibility** - JSON schema versioning
3. **Test all formats** - Changes may affect multiple generators
4. **Sanitize all output** - No raw user paths or sensitive data
5. **Optimize for large reports** - Streaming generation for big captures
6. **Preserve evidence integrity** - File hashes, timestamps
7. **Cross-browser testing** - HTML must work in Chrome, Firefox, Edge
8. **PDF accessibility** - Consider screen readers, text selection
