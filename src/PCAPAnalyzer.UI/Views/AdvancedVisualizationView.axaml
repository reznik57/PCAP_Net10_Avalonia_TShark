<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:charts="using:PCAPAnalyzer.UI.Controls.Charts"
             xmlns:lvc="using:LiveChartsCore.SkiaSharpView.Avalonia"
             x:Class="PCAPAnalyzer.UI.Views.AdvancedVisualizationView"
             x:CompileBindings="False">

  <Grid RowDefinitions="Auto,*">
    <!-- Header -->
    <Border Grid.Row="0" Background="#1E293B" Padding="20" BorderBrush="#334155"
            BorderThickness="0,0,0,2">
      <Grid ColumnDefinitions="*,Auto">
        <StackPanel Grid.Column="0" Spacing="5">
          <TextBlock Text="Advanced Visualizations" FontSize="24" FontWeight="Bold"
                     Foreground="White" />
          <TextBlock Text="Interactive dashboards and real-time charts"
                     Foreground="#94A3B8" FontSize="14" />
        </StackPanel>
        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="10"
                    VerticalAlignment="Center">
          <Button Content="Export All" Command="{Binding ExportAllCommand}"
                  Classes="primary-button" />
          <Button Content="Refresh" Command="{Binding RefreshCommand}"
                  Classes="secondary-button" />
        </StackPanel>
      </Grid>
    </Border>

    <!-- Main Content -->
    <ScrollViewer Grid.Row="1" Background="#0F172A">
      <StackPanel Margin="20" Spacing="20">

        <!-- Dashboard Cards -->
        <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="15">
          <!-- Total Packets Card -->
          <Border Grid.Column="0" Classes="dashboard-card">
            <StackPanel Spacing="10">
              <TextBlock Text="Total Packets" Classes="card-title" />
              <TextBlock Text="{Binding DataPointCount, StringFormat='{}{0:N0}'}"
                         Classes="card-value" />
              <TextBlock Text="packets analyzed" Classes="card-subtitle" />
            </StackPanel>
          </Border>

          <!-- Node Count Card -->
          <Border Grid.Column="1" Classes="dashboard-card">
            <StackPanel Spacing="10">
              <TextBlock Text="Network Nodes" Classes="card-title" />
              <TextBlock Text="{Binding NodeCount}" Classes="card-value" />
              <TextBlock Text="active endpoints" Classes="card-subtitle" />
            </StackPanel>
          </Border>

          <!-- Edge Count Card -->
          <Border Grid.Column="2" Classes="dashboard-card">
            <StackPanel Spacing="10">
              <TextBlock Text="Connections" Classes="card-title" />
              <TextBlock Text="{Binding EdgeCount}" Classes="card-value" />
              <TextBlock Text="active flows" Classes="card-subtitle" />
            </StackPanel>
          </Border>

          <!-- Last Update Card -->
          <Border Grid.Column="3" Classes="dashboard-card">
            <StackPanel Spacing="10">
              <TextBlock Text="Last Update" Classes="card-title" />
              <TextBlock Text="{Binding LastUpdate, StringFormat='{}{0:HH:mm:ss}'}"
                         Classes="card-value" />
              <TextBlock Text="{Binding StatusMessage}" Classes="card-subtitle" />
            </StackPanel>
          </Border>
        </Grid>

        <!-- Time Series Chart -->
        <Border Classes="chart-container">
          <StackPanel Spacing="10">
            <TextBlock Text="Real-Time Traffic Analysis" Classes="section-title" />
            <charts:InteractiveTimeSeriesChart DataContext="{Binding}"
                                               Height="400" />
          </StackPanel>
        </Border>

        <!-- Dual Chart Layout: Heatmap and Network Graph -->
        <Grid ColumnDefinitions="*,*" ColumnSpacing="20">
          <!-- Traffic Heatmap -->
          <Border Grid.Column="0" Classes="chart-container">
            <StackPanel Spacing="10">
              <TextBlock Text="Traffic Heatmap (Time vs Protocol)"
                         Classes="section-title" />
              <charts:HeatmapChart DataContext="{Binding}" Height="500" />
            </StackPanel>
          </Border>

          <!-- Network Topology Graph -->
          <Border Grid.Column="1" Classes="chart-container">
            <StackPanel Spacing="10">
              <TextBlock Text="Network Topology" Classes="section-title" />
              <charts:NetworkGraphChart DataContext="{Binding}" Height="500" />
            </StackPanel>
          </Border>
        </Grid>

        <!-- Statistical Charts -->
        <Grid ColumnDefinitions="*,*" ColumnSpacing="20">
          <!-- Histogram -->
          <Border Grid.Column="0" Classes="chart-container">
            <StackPanel Spacing="10">
              <TextBlock Text="Packet Size Distribution" Classes="section-title" />
              <lvc:CartesianChart Series="{Binding HistogramSeries}"
                                  Height="350"
                                  Background="#1A202C" />
            </StackPanel>
          </Border>

          <!-- Box Plot Placeholder -->
          <Border Grid.Column="1" Classes="chart-container">
            <StackPanel Spacing="10">
              <TextBlock Text="Latency Analysis (Box Plot)" Classes="section-title" />
              <lvc:CartesianChart Series="{Binding BoxPlotSeries}"
                                  Height="350"
                                  Background="#1A202C" />
            </StackPanel>
          </Border>
        </Grid>

        <!-- Advanced Analytics Section -->
        <Border Classes="chart-container">
          <StackPanel Spacing="15">
            <TextBlock Text="Advanced Analytics" Classes="section-title" />

            <Grid ColumnDefinitions="*,*,*" ColumnSpacing="15">
              <!-- Correlation Matrix Card -->
              <Border Classes="analytics-card">
                <StackPanel Spacing="10">
                  <TextBlock Text="Correlation Analysis" FontWeight="SemiBold"
                             Foreground="White" FontSize="14" />
                  <TextBlock Text="Protocol vs Size correlation: 0.73"
                             Foreground="#94A3B8" FontSize="12" />
                  <TextBlock Text="Time Delta vs Size: 0.45"
                             Foreground="#94A3B8" FontSize="12" />
                  <Button Content="View Full Matrix" Classes="tertiary-button"
                          HorizontalAlignment="Left" Margin="0,10,0,0" />
                </StackPanel>
              </Border>

              <!-- Trend Analysis Card -->
              <Border Classes="analytics-card">
                <StackPanel Spacing="10">
                  <TextBlock Text="Trend Detection" FontWeight="SemiBold"
                             Foreground="White" FontSize="14" />
                  <TextBlock Text="Upward trend in traffic volume"
                             Foreground="#10B981" FontSize="12" />
                  <TextBlock Text="Peak hours: 14:00 - 16:00"
                             Foreground="#94A3B8" FontSize="12" />
                  <Button Content="Analyze Trends" Classes="tertiary-button"
                          HorizontalAlignment="Left" Margin="0,10,0,0" />
                </StackPanel>
              </Border>

              <!-- Export Options Card -->
              <Border Classes="analytics-card">
                <StackPanel Spacing="10">
                  <TextBlock Text="Export Options" FontWeight="SemiBold"
                             Foreground="White" FontSize="14" />
                  <Button Content="Export as PNG" Classes="export-button" />
                  <Button Content="Export as SVG" Classes="export-button" />
                  <Button Content="Export Data CSV" Classes="export-button" />
                  <Button Content="Generate Report" Classes="export-button" />
                </StackPanel>
              </Border>
            </Grid>
          </StackPanel>
        </Border>

      </StackPanel>
    </ScrollViewer>
  </Grid>

  <UserControl.Styles>
    <!-- Dashboard Cards -->
    <Style Selector="Border.dashboard-card">
      <Setter Property="Background" Value="#1E293B" />
      <Setter Property="Padding" Value="20" />
      <Setter Property="CornerRadius" Value="8" />
      <Setter Property="BorderBrush" Value="#334155" />
      <Setter Property="BorderThickness" Value="1" />
    </Style>

    <Style Selector="TextBlock.card-title">
      <Setter Property="Foreground" Value="#94A3B8" />
      <Setter Property="FontSize" Value="12" />
      <!-- TextTransform removed - not supported in Avalonia 11.3.4 -->
    </Style>

    <Style Selector="TextBlock.card-value">
      <Setter Property="Foreground" Value="White" />
      <Setter Property="FontSize" Value="32" />
      <Setter Property="FontWeight" Value="Bold" />
    </Style>

    <Style Selector="TextBlock.card-subtitle">
      <Setter Property="Foreground" Value="#64748B" />
      <Setter Property="FontSize" Value="11" />
    </Style>

    <!-- Chart Containers -->
    <Style Selector="Border.chart-container">
      <Setter Property="Background" Value="#1E293B" />
      <Setter Property="Padding" Value="20" />
      <Setter Property="CornerRadius" Value="8" />
      <Setter Property="BorderBrush" Value="#334155" />
      <Setter Property="BorderThickness" Value="1" />
    </Style>

    <Style Selector="Border.analytics-card">
      <Setter Property="Background" Value="#2D3748" />
      <Setter Property="Padding" Value="15" />
      <Setter Property="CornerRadius" Value="6" />
      <Setter Property="BorderBrush" Value="#4A5568" />
      <Setter Property="BorderThickness" Value="1" />
    </Style>

    <Style Selector="TextBlock.section-title">
      <Setter Property="Foreground" Value="White" />
      <Setter Property="FontSize" Value="18" />
      <Setter Property="FontWeight" Value="SemiBold" />
    </Style>

    <!-- Buttons -->
    <Style Selector="Button.primary-button">
      <Setter Property="Background" Value="#3B82F6" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="Padding" Value="15,8" />
      <Setter Property="CornerRadius" Value="6" />
      <Setter Property="FontWeight" Value="SemiBold" />
    </Style>

    <Style Selector="Button.primary-button:pointerover">
      <Setter Property="Background" Value="#2563EB" />
    </Style>

    <Style Selector="Button.secondary-button">
      <Setter Property="Background" Value="#334155" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="Padding" Value="15,8" />
      <Setter Property="CornerRadius" Value="6" />
    </Style>

    <Style Selector="Button.secondary-button:pointerover">
      <Setter Property="Background" Value="#475569" />
    </Style>

    <Style Selector="Button.tertiary-button">
      <Setter Property="Background" Value="#4A5568" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="Padding" Value="10,5" />
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="FontSize" Value="12" />
    </Style>

    <Style Selector="Button.export-button">
      <Setter Property="Background" Value="Transparent" />
      <Setter Property="Foreground" Value="#94A3B8" />
      <Setter Property="Padding" Value="8,4" />
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="HorizontalAlignment" Value="Stretch" />
      <Setter Property="HorizontalContentAlignment" Value="Left" />
      <Setter Property="FontSize" Value="12" />
      <Setter Property="BorderBrush" Value="#4A5568" />
      <Setter Property="BorderThickness" Value="1" />
    </Style>

    <Style Selector="Button.export-button:pointerover">
      <Setter Property="Background" Value="#374151" />
      <Setter Property="Foreground" Value="White" />
    </Style>
  </UserControl.Styles>
</UserControl>
