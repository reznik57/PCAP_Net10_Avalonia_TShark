<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:PCAPAnalyzer.UI.ViewModels"
        mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="400"
        x:Class="PCAPAnalyzer.UI.Views.PacketNumbersDetailWindow"
        x:DataType="vm:PacketNumbersDetailViewModel"
        Title="Packet Details"
        Width="600"
        Height="400"
        WindowStartupLocation="CenterOwner"
        CanResize="True">
    
    <Window.Styles>
        <StyleInclude Source="/Styles/UnifiedDarkTheme.axaml"/>
        
        <Style Selector="Border.header-panel">
            <Setter Property="Background" Value="{DynamicResource Background2Brush}"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderSubtleBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
        </Style>

        <Style Selector="TextBlock.detail-label">
            <Setter Property="FontSize" Value="{StaticResource FontSizeBase}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
        </Style>

        <Style Selector="TextBlock.detail-value">
            <Setter Property="FontSize" Value="{StaticResource FontSizeInput}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
    </Window.Styles>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" Classes="header-panel">
            <StackPanel>
                <TextBlock Text="{Binding Title}"
                          FontSize="{StaticResource FontSizeXL}"
                          FontWeight="Bold"
                          Foreground="{DynamicResource TextPrimaryBrush}"
                          Margin="0,0,0,10"/>
                
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,20,0">
                        <TextBlock Classes="detail-label" Text="Type:"/>
                        <TextBlock Classes="detail-value" Text="{Binding EntryType}"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="0,0,20,0">
                        <TextBlock Classes="detail-label" Text="Value:"/>
                        <TextBlock Classes="detail-value" Text="{Binding EntryValue}"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="0,0,20,0">
                        <TextBlock Classes="detail-label" Text="Total Packets:"/>
                        <TextBlock Classes="detail-value" Text="{Binding TotalPackets, StringFormat='{}{0:N0}'}"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="3" Orientation="Horizontal">
                        <TextBlock Classes="detail-label" Text="Total Bytes:"/>
                        <TextBlock Classes="detail-value" Text="{Binding TotalBytesFormatted}"/>
                    </StackPanel>
                </Grid>
            </StackPanel>
        </Border>
        
        <!-- Packet Numbers List -->
        <Border Grid.Row="1"
                Background="{DynamicResource BackgroundDark}"
                BorderBrush="{DynamicResource BackgroundCard}"
                BorderThickness="1"
                Margin="10,10,10,10"
                CornerRadius="8"
                Padding="10,10,10,10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0"
                          Text="Associated Packet Numbers"
                          FontSize="{StaticResource FontSizeInput}"
                          FontWeight="SemiBold"
                          Foreground="{DynamicResource TextSecondaryBrush}"
                          Margin="0,0,0,10"/>
                
                <ScrollViewer Grid.Row="1" 
                             VerticalScrollBarVisibility="Auto"
                             HorizontalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding PacketNumbers}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="vm:PacketNumberViewModel">
                                <Border Background="{DynamicResource BackgroundCardBrush}"
                                        BorderBrush="{DynamicResource BorderSubtleBrush}"
                                        BorderThickness="1"
                                        CornerRadius="{StaticResource RadiusSmall}"
                                        Margin="3"
                                        Padding="8,4"
                                        ToolTip.Tip="{Binding PacketInfo}">
                                    <TextBlock Text="{Binding Number, StringFormat='#{0}'}"
                                              Foreground="{DynamicResource AccentCyanBrush}"
                                              FontFamily="Consolas,monospace"
                                              FontSize="{StaticResource FontSizeMedium}"/>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>
        
        <!-- Footer with Actions -->
        <Border Grid.Row="2"
                Background="{DynamicResource BackgroundPanel}"
                BorderBrush="{DynamicResource BorderPrimary}"
                BorderThickness="0,1,0,0"
                Padding="20,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="5">
                    <TextBlock Text="Display Range:"
                              VerticalAlignment="Center"
                              Foreground="{DynamicResource TextSecondaryBrush}"
                              Margin="0,0,10,0"/>
                    <ComboBox SelectedItem="{Binding DisplayRange}"
                             MinWidth="100">
                        <ComboBoxItem>All</ComboBoxItem>
                        <ComboBoxItem>First 100</ComboBoxItem>
                        <ComboBoxItem>First 500</ComboBoxItem>
                        <ComboBoxItem>First 1000</ComboBoxItem>
                    </ComboBox>
                </StackPanel>
                
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="10">
                    <Button Content="Export List"
                           Command="{Binding ExportCommand}"
                           Background="{DynamicResource AccentPrimary}"
                           Foreground="White"
                           Padding="12,6"/>
                    <Button Content="Copy Numbers"
                           Command="{Binding CopyCommand}"
                           Background="{DynamicResource SlackSuccess}"
                           Foreground="White"
                           Padding="12,6"/>
                    <Button Content="Close"
                           Click="CloseButton_Click"
                           Background="{DynamicResource BackgroundElevatedBrush}"
                           Foreground="{DynamicResource TextPrimaryBrush}"
                           Padding="12,6"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>