<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="PCAPAnalyzer.UI.Controls.ResizablePopupView"
             x:CompileBindings="False">
    
    <Grid>
        <!-- Dark Overlay -->
        <Border Classes="modal-overlay"
                IsVisible="{Binding IsPopupVisible}"
                IsHitTestVisible="True"
                ZIndex="1000">
            <Border.Transitions>
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.3"/>
                </Transitions>
            </Border.Transitions>
        </Border>
        
        <!-- Resizable Popup Container -->
        <Grid x:Name="PopupContainer"
              IsVisible="{Binding IsPopupVisible}"
              ZIndex="1001"
              HorizontalAlignment="Center"
              VerticalAlignment="Center">
            
            <!-- Main Content Border (Resizable) -->
            <Border x:Name="ResizableBorder"
                    Classes="modal-content"
                    Width="1000"
                    Height="650"
                    MinWidth="600"
                    MinHeight="400"
                    MaxWidth="1600"
                    MaxHeight="1200"
                    Background="{DynamicResource PopupBgSecondary}"
                    BorderBrush="{DynamicResource PopupBorder}"
                    BorderThickness="1"
                    CornerRadius="16"
                    BoxShadow="0 20 60 -10 #000000AA">
                
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Header (Draggable) -->
                    <Border x:Name="HeaderBorder"
                            Grid.Row="0"
                            Background="{DynamicResource PopupBg}"
                            CornerRadius="16,16,0,0"
                            Padding="24,16">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="{Binding PopupTitle}"
                                           FontSize="{DynamicResource FontSizeXL}"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource AccentCyan}"/>
                                <TextBlock Text="{Binding PopupSubtitle}"
                                           FontSize="{DynamicResource FontSizeMedium}"
                                           Foreground="{DynamicResource TextSecondary}"
                                           Margin="0,4,0,0"
                                           IsVisible="{Binding PopupSubtitle, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                            </StackPanel>

                            <!-- Window Controls -->
                            <StackPanel Grid.Column="1"
                                        Orientation="Horizontal"
                                        Spacing="8">

                                <!-- Maximize/Restore Button -->
                                <Button x:Name="MaximizeButton"
                                        Width="32"
                                        Height="32"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        ToolTip.Tip="Maximize">
                                    <Path Data="M 4 4 L 20 4 L 20 20 L 4 20 Z M 4 7 L 20 7"
                                          Stroke="{DynamicResource TextSecondary}"
                                          StrokeThickness="1.5"
                                          Width="16"
                                          Height="16"/>
                                </Button>

                                <!-- Close Button -->
                                <Button Command="{Binding ClosePopupCommand}"
                                        Width="32"
                                        Height="32"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        ToolTip.Tip="Close">
                                    <Path Data="M 18 6 L 6 18 M 6 6 L 18 18"
                                          Stroke="{DynamicResource TextSecondary}"
                                          StrokeThickness="2"
                                          Width="16"
                                          Height="16"/>
                                </Button>
                            </StackPanel>
                        </Grid>
                    </Border>
                    
                    <!-- Content Area -->
                    <ScrollViewer Grid.Row="1"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Auto"
                                  Padding="24,24,24,24">
                        <ContentControl Content="{Binding PopupContent}"/>
                    </ScrollViewer>
                    
                    <!-- Footer with Actions -->
                    <Border Grid.Row="2"
                            Background="{DynamicResource PopupBg}"
                            CornerRadius="0,0,16,16"
                            Padding="24,16"
                            IsVisible="{Binding HasPopupActions}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Size Indicator -->
                            <TextBlock Grid.Column="0"
                                       x:Name="SizeIndicator"
                                       Foreground="{DynamicResource TextMuted}"
                                       FontSize="{DynamicResource FontSizeSmall}"
                                       VerticalAlignment="Center"/>

                            <!-- Action Buttons -->
                            <StackPanel Grid.Column="1"
                                        Orientation="Horizontal"
                                        HorizontalAlignment="Right"
                                        Spacing="12">

                                <!-- Export Button -->
                                <Button Command="{Binding ExportPopupDataCommand}"
                                        IsVisible="{Binding CanExportPopupData}">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <Path Data="M 14 2 L 14 8 L 20 8 M 14 2 L 20 8 L 20 22 L 4 22 L 4 2 Z M 12 12 L 12 18 M 9 15 L 12 18 L 15 15"
                                              Fill="{DynamicResource PopupText}"
                                              Width="16"
                                              Height="16"/>
                                        <TextBlock Text="Export" Foreground="{DynamicResource PopupText}"/>
                                    </StackPanel>
                                </Button>

                                <!-- Refresh Button -->
                                <Button Command="{Binding RefreshPopupDataCommand}"
                                        IsVisible="{Binding CanRefreshPopupData}">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <Path Data="M 17.65 6.35 C 16.2 4.9 14.21 4 12 4 C 7.58 4 4 7.58 4 12 C 4 16.42 7.58 20 12 20 C 15.73 20 18.84 17.45 19.73 14 L 17.65 14 C 16.83 16.33 14.61 18 12 18 C 8.69 18 6 15.31 6 12 C 6 8.69 8.69 6 12 6 C 13.66 6 15.14 6.69 16.22 7.78 L 13 11 L 20 11 L 20 4 L 17.65 6.35 Z"
                                              Fill="{DynamicResource PopupText}"
                                              Width="16"
                                              Height="16"/>
                                        <TextBlock Text="Refresh" Foreground="{DynamicResource PopupText}"/>
                                    </StackPanel>
                                </Button>

                                <!-- Close Button -->
                                <Button Command="{Binding ClosePopupCommand}"
                                        Classes="primary">
                                    <TextBlock Text="Close" Foreground="{DynamicResource TextInverse}" FontWeight="Medium"/>
                                </Button>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
            
            <!-- Resize Handles -->
            <!-- Top Left -->
            <Border x:Name="ResizeNW"
                    Width="20"
                    Height="20"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Top"
                    Background="Transparent"
                    
                    ZIndex="1002"/>
            
            <!-- Top -->
            <Border x:Name="ResizeN"
                    Height="8"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Top"
                    Background="Transparent"
                    
                    Margin="20,0,20,0"
                    ZIndex="1002"/>
            
            <!-- Top Right -->
            <Border x:Name="ResizeNE"
                    Width="20"
                    Height="20"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Background="Transparent"
                    
                    ZIndex="1002"/>
            
            <!-- Left -->
            <Border x:Name="ResizeW"
                    Width="8"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Stretch"
                    Background="Transparent"
                    
                    Margin="0,20,0,20"
                    ZIndex="1002"/>
            
            <!-- Right -->
            <Border x:Name="ResizeE"
                    Width="8"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Stretch"
                    Background="Transparent"
                    
                    Margin="0,20,0,20"
                    ZIndex="1002"/>
            
            <!-- Bottom Left -->
            <Border x:Name="ResizeSW"
                    Width="20"
                    Height="20"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Bottom"
                    Background="Transparent"
                    
                    ZIndex="1002"/>
            
            <!-- Bottom -->
            <Border x:Name="ResizeS"
                    Height="8"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Bottom"
                    Background="Transparent"
                    
                    Margin="20,0,20,0"
                    ZIndex="1002"/>
            
            <!-- Bottom Right (with visual grip) -->
            <Border x:Name="ResizeSE"
                    Width="20"
                    Height="20"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Bottom"
                    Background="Transparent"

                    ZIndex="1002">
                <!-- Visual resize grip indicator -->
                <Path Data="M 2 14 L 14 2 M 6 14 L 14 6 M 10 14 L 14 10"
                      Stroke="{DynamicResource PopupBorder}"
                      StrokeThickness="1.5"
                      Opacity="0.6"
                      Margin="4,4,4,4"/>
            </Border>
        </Grid>
    </Grid>
</UserControl>